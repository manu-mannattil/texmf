% NAME
%
%   emem.sty - a personal LaTeX style file
%
% DESCRIPTION
%
%   emem.sty is an opinionated LaTeX style file meant to be used with
%   the memoir LaTeX class.  This style file monkey patches some
%   commands to typeset things the way I want.
%
% USAGE
%
%   emem.sty can be loaded like any other package with \usepackage{emem}.
%
% OPTIONS
%
%   cmd     --  define custom commands and load a minimum set of
%               packages, but don't do anything else
%   draft   --  disable loading of cosmetic/heavyweight packages
%

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{emem}[2020/01/01 v0.1]

%%% Option processing ---------------------------------------------------------

\newif\if@fancy
\DeclareOption{fancy}\@fancytrue
\DeclareOption{draft}\@fancyfalse

\newif\if@cmd
\DeclareOption{cmd}\@cmdtrue

\ExecuteOptions{fancy}
\ProcessOptions\relax

%%% Mathematics ---------------------------------------------------------------

\RequirePackage{mathtools}

% Dirac bra-ket notation (from braket.sty).
\def\bra#1{\mathinner{\langle{#1}\rvert}}
\def\ket#1{\mathinner{\lvert{#1}\rangle}}
\def\braket#1{\mathinner{\langle{#1}\rangle}}
\def\Bra#1{\left\langle#1\right|}
\def\Ket#1{\left|#1\right\rangle}

% Upright derivates and partials.
\def\dd{\ensuremath\mathrm{d}}
\def\Dd{\ensuremath\mathrm{D}}
\def\pd{\ensuremath\partial}

% Linear algebra
\def\hess{\ensuremath\nabla\nabla}                  % Hessian (two nablas)
\def\trans{\ensuremath{^\mathsf{T}}}                % transpose

% New operators.
\DeclareMathOperator{\coker}{coker}   % cokernel of a matrix
\DeclareMathOperator{\corank}{corank} % corank of a matrix
\DeclareMathOperator{\erf}{erf}       % Gauss error function
\DeclareMathOperator{\im}{im}         % image of a map
\DeclareMathOperator{\rank}{rank}     % rank of a matrix
\DeclareMathOperator{\Residue}{Res}   % residue
\DeclareMathOperator{\trace}{tr}      % trace of a matrix
\DeclareMathOperator{\Trace}{Tr}      % trace of a matrix (alternate)

\def\id{\mathrm{id}}                  % identity map

% Absolute value sign.  Simply using |...| results in poor spacing, e.g., see
% the output of $|-1|$ vs $|{-1}|$.  It's the second kind of spacing that we
% want.  Source: https://tex.stackexchange.com/q/43008
\DeclarePairedDelimiter{\abs}{\lvert}{\rvert}
\DeclarePairedDelimiter{\Abs}{\|}{\|} % || ... || version

%%% Miscellaneous -------------------------------------------------------------

\def\etal{\emph{et al.}}

\def\blankpage{\newpage\phantom{}\thispagestyle{empty}}

%%% Environments --------------------------------------------------------------

% Environment for typing right-indented quotes and command for typing the
% name of the quotee.
\newenvironment{rightquote}[1]{%
  \flushright%
  \begin{minipage}{#1\textwidth}%
}{%
  \end{minipage}\par%
}
\def\quotee#1{\par\flushright\unskip\normalfont{#1}}

% Environment to vertically/horizontally center text.
\newenvironment{center*}
  {\hspace{0pt}\vfill\begin{center}}
  {\end{center}\vfill\hspace{0pt}}

%%% Git info ------------------------------------------------------------------

% An NIH-hack to avoid using the gitinfo2 package.  To generate the
% gitInfo.in file, within the root directory of the repository, run
%
%   git --no-pager log -1 --date=short --decorate=short --pretty=format:'
%     \def\gitHash{%H}
%     \def\gitShortHash{%h}
%     \def\gitRefName{%D}
%     \def\gitAuthorName{%an}
%     \def\gitAuthorEmail{%ae}
%     \def\gitAuthorDate{%ai}
%     \def\gitAuthorAltDate{%aD}
%     \def\gitCommitterName{%cn}
%     \def\gitCommitterEmail{%ce}
%     \def\gitCommitterDate{%ci}
%     \def\gitCommitterAltDate{%cD}
%   ' HEAD >.git/gitInfo.in
%
\ifdefined\gitInfo\else\def\gitInfo{.git/gitInfo.in}\fi
\IfFileExists{\gitInfo}{\input{\gitInfo}}{
  \def\gitError{$\heartsuit\heartsuit\heartsuit$}
  \def\gitHash{\gitError}
  \def\gitShortHash{\gitError}
  \def\gitRefName{\gitError}
  \def\gitAuthorName{\gitError}
  \def\gitAuthorEmail{\gitError}
  \def\gitAuthorDate{\gitError}
  \def\gitAuthorAltDate{\gitError}
  \def\gitCommitterName{\gitError}
  \def\gitCommitterEmail{\gitError}
  \def\gitCommitterDate{\gitError}
  \def\gitCommitterAltDate{\gitError}
}

% NOTE: Lines following this apply to the article and book LaTeX classes.
% Thus, terminate processing at this point if the `cmd' option is given.
\if@cmd\endinput\fi

%%% Package loading -----------------------------------------------------------

% Only packages included in a standard TeXLive distribution ought to be
% loaded by default.
\RequirePackage{color}

\definecolor{gray}{rgb} {0.5,0.5,0.5}
\definecolor{grey}{rgb} {0.5,0.5,0.5}
\definecolor{steel}{rgb}{0.2,0.4,0.6}

% Highlights
\definecolor{hlcolor}{rgb}{0.7,0.1,0.0}
\def\hl#1{{\color{hlcolor}#1}}
\newenvironment{hlblock}{\color{hlcolor}}{}

% Load heavyweights and cosmetic packages by default, but also give an option
% to disable them.
\if@fancy
  % % Use the same color for all links.
  \RequirePackage[
    allcolors=steel,
    breaklinks,
    colorlinks,
    unicode,
  ]{hyperref}
  \urlstyle{same}
  \RequirePackage{microtype}
  \RequirePackage{graphicx}
\else
  \RequirePackage[draft]{hyperref}
  \RequirePackage[draft]{graphicx}
  \RequirePackage[draft]{microtype}
\fi

%%% Custom package-depended commands ------------------------------------------

% % Commands to typeset emails/DOI links that obeys \urlstyle.
\def\email#1{\href{mailto:#1}{\nolinkurl{#1}}}
\def\doi#1#2{\href{https://dx.doi.org/#1}{\nolinkurl{#2}}}

% Define \alturl to get a \url-like command that can accept an
% alternative text.  This is not equivalent to \href since the text gets
% hyphenated (and treated like ordinary text) with \href.
\def\alturl#1#2{\href{#1}{\nolinkurl{#2}}}

% AMS packages ----------------------------------------------------------------

\RequirePackage{amsthm}

% Break display eqs
\allowdisplaybreaks

% Theorem style with period after the theorem head removed and bold theorem
% spec: https://tex.stackexchange.com/a/185168.
\newtheoremstyle{ememstyle}%                      % name
  {}%                                             % space above
  {}%                                             % space below
  {\itshape}%                                     % body font
  {}%                                             % indent amount
  {\bfseries}%                                    % theorem head font
  {.}%                                            % punctuation after theorem head
  {1.2em}%                                        % space after theorem head, ' ', or \newline
  {\thmname{#1}\thmnumber{ #2}\thmnote{ (#3)}}%   % theorem head spec (can be left empty, meaning `normal')

\theoremstyle{ememstyle}
\newtheorem{claim}{Claim}
\newtheorem{prop}{Proposition}
\newtheorem{theorem}{Theorem}
\newtheorem{definition}{Definition}

% Problem + solution as theorem/proof style environments.
\theoremstyle{definition}
\newtheorem{problem}{Problem}
\newtheorem{example}{Example}
\newenvironment{solution}{\proof[Solution]}{\endproof}

%%% Whitespace management -----------------------------------------------------

% From Section 3.5 of memoir's documentation.
\clubpenalty=9996
\widowpenalty=9999
\brokenpenalty=4991
\predisplaypenalty=10000
\postdisplaypenalty=1549
\displaywidowpenalty=1602

%%% Memoir customization -----------------------------------------------

\def\cap@family{\sffamily}
\def\cap@altfamily{\bfseries\sffamily}

% Use smaller sans-serif fonts in chapter headings.
\def\chapnumfont{\large\cap@family}
\def\chapnamefont{\large\cap@family}
\def\chaptitlefont{\Large\cap@altfamily}
\setlength{\beforechapskip}{4em}
\setlength{\midchapskip}{0.25em}
\setlength{\afterchapskip}{3em}

% sans-serif fonts for section titles.
\setsecheadstyle{\large\cap@altfamily}
\setsubsecheadstyle{\cap@altfamily}
\setsubsubsecheadstyle{\itshape\cap@family}

% Table of Contents.
\def\cftchapterfont{\cap@altfamily}          % bold sans-serif for chapters
\def\cftchapterpagefont{\cftchapterfont}    % also for page numbers
\def\cftdotsep{1234}                        % no dotted lines

% Make captions in tables, figures, etc., to use a period after the caption
% identifier (e.g., Figure, Table, etc.) instead of a colon.  Also use sans
% font for the identifier.
\captionnamefont{\bfseries\sffamily}
\captiondelim{.\enspace}

% Number everything from sections to subsections.
\setsecnumdepth{subsection}

% Article-specific tweaks.
\@ifclasswith{memoir}{article}{
  % Omit chapter numbers from section titles.
  \counterwithout{section}{chapter}
  % Number subsubsections as well.
  \setsecnumdepth{subsubsection}
}{}

\endinput

% vim: ft=tex et sts=2 sw=2 nospell cole=0
